<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Mongock Documentation">

    <title>Mongock Documentation</title>

    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" sizes="any" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png" />
    <link rel="shortcut icon" href="/favicon/favicon.ico" />
    <link href="/styles/base-styles.css" rel="stylesheet" />
    <link href="/styles/content.css" rel="stylesheet" />
    <link href="/styles/layout.css" rel="stylesheet" />
    <link href="/styles/side-menu.css" rel="stylesheet" />
    <link href="/styles/util.css" rel="stylesheet" />
    <link href="/styles/prism-base16-ateliersulphurpool.light.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Fjalla+One|Roboto" rel="stylesheet" />
  </head>

  <body>

    <!-- Header navigation -->
    <header>
  <div class="page-max-width d-flex flex-space-between flex-content-center">
    <div class="d-flex flex-items-center ml-0 mr-auto">
      <a class="logo d-inline-flex flex-items-center" href="https://www.mongock.io">
        <span class="mr-12">Mongock</span>
        <p class="text-left">
          <img src="/images/logo.png" width="15%" alt="Mongock">
        </p>  
       </a>
    </div>

    <nav class="d-flex flex-items-center ml-auto mr-0">
      <a class="mr-24" href="/">
        Home
      </a>
      <a href="https://github.com/mongock/mongock" target="_blank" rel="nofolllow">
        <!-- Source: <https://github.com/encharm/Font-Awesome-SVG-PNG/blob/master/black/svg/github.svg> -->
<svg focusable="false" viewBox="0 0 1792 1792"><title>GitHub</title><path d="M896 128q209 0 385.5 103t279.5 279.5 103 385.5q0 251-146.5 451.5t-378.5 277.5q-27 5-40-7t-13-30q0-3 .5-76.5t.5-134.5q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105 20.5-150.5q0-119-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27t-83.5-38.5-85-13.5q-45 113-8 204-79 87-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-39 36-49 103-21 10-45 15t-57 5-65.5-21.5-55.5-62.5q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 88.5t.5 54.5q0 18-13 30t-40 7q-232-77-378.5-277.5t-146.5-451.5q0-209 103-385.5t279.5-279.5 385.5-103zm-477 1103q3-7-7-12-10-3-13 2-3 7 7 12 9 6 13-2zm31 34q7-5-2-16-10-9-16-3-7 5 2 16 10 10 16 3zm30 45q9-7 0-19-8-13-17-6-9 5 0 18t17 7zm42 42q8-8-4-19-12-12-20-3-9 8 4 19 12 12 20 3zm57 25q3-11-13-16-15-4-19 7t13 15q15 6 19-6zm63 5q0-13-17-11-16 0-16 11 0 13 17 11 16 0 16-11zm58-10q-2-11-18-9-16 3-14 15t18 8 14-14z"></path></svg>

        <span class="ml-8">GitHub</span>
      </a>
    </nav>
  </div>
</header>


    <!-- Main page content -->
    <main class="page-max-width">
      




<script>
const versions = [];

 
versions.push({value: "v5", index: "/index.html" });
  
let defaultVersion = "v5";
  

 
versions.push({value: "v4", index: "/v4/index.html" });
  

 
versions.push({value: "v3", index: "/v3/index.html" });
  


const selectedVersions = defaultVersion;
window.onload = function() {
  const urlVersion = window.location.pathname.split("/")[1];
  let validVersion = "";
  versions.forEach(version => {
    if(urlVersion == version.value) {
      validVersion = urlVersion;
    }
  })
  pickVersion(validVersion);
};

function pickVersion(urlVersion) {
  const pickedVersion = urlVersion || defaultVersion;
  document.getElementById("versionSelect").value = pickedVersion;
  versions.forEach(version => {
    const htmlElement = document.getElementById(version.value);
    if(htmlElement) {
      if(pickedVersion == version.value) {
        htmlElement.style.display = "inline";
      } else {
        htmlElement.style.display = "none";
      }
    }
    
  });
}

function changeVersion() {
  var newVersion = document.getElementById("versionSelect").value;
  for(let i = 0 ; i < versions.length ; i++) {
    const version = versions[i];
    if(version.value == newVersion) {
      window.location.href = window.location.origin + version.index;

    } else {
      console.log("version " + newVersion + " not found. Not redirecting.")
    }
  }
}

</script>






<aside class="side-menu">
  
  <select style="width: 100%" name="version" id="versionSelect" onchange="changeVersion()">
    
      <option value="v5">version 5</option>
    
      <option value="v4">version 4</option>
    
      <option value="v3">version 3</option>
    
  </select>
  <br /><br />



  <nav class="menu-root">
    
      <div id="v5" style="display: none;">
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/index.html">
        What is mongock
      </a>
    
  </h7>

          <nav class="What is mongock">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/technical-overview/index.html">
        Technical overview
      </a>
    
  </h7>

          <nav class="Technical overview">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/get-started/index.html">
        Get started
      </a>
    
  </h7>

          <nav class="Get started">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/migration/index.html">
        Migration
      </a>
    
  </h7>

          <nav class="Migration">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/runner/index.html">
        Runner
      </a>
    
  </h7>

          <nav class="Runner">
            
              
  
  <a class="menu-item "  href="/v5/runner/standalone/index.html">
    Runner: Standalone
  </a>

            
              
  
  <a class="menu-item "  href="/v5/runner/springboot/index.html">
    Runner: Springboot
  </a>

            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/driver/index.html">
        Driver
      </a>
    
  </h7>

          <nav class="Driver">
            
              
  
  <a class="menu-item current-page"  href="/v5/driver/mongodb/index.html">
    MongoDB
  </a>

            
              
  
  <a class="menu-item "  href="/v5/driver/cosmosdb/index.html">
    CosmosDB
  </a>

            
              
  
  <a class="menu-item "  href="/v5/driver/documentdb/index.html">
    DocumentDB
  </a>

            
              
  
  <a class="menu-item "  href="/v5/driver/dynamodb/index.html">
    DynamoDB
  </a>

            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      Features
    
  </h7>

          <nav class="Features">
            
              
  
  <a class="menu-item "  href="/v5/features/transactions/index.html">
    Transactions
  </a>

            
              
  
  <a class="menu-item "  href="/v5/features/events/index.html">
    Events
  </a>

            
              
  
  <a class="menu-item "  href="/v5/features/legacy-migration/index.html">
    Legacy migration
  </a>

            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/CLI/index.html">
        CLI
      </a>
    
  </h7>

          <nav class="CLI">
            
              
  
  <a class="menu-item "  href="/v5/CLI/operations/index.html">
    Operations
  </a>

            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/resources/index.html">
        Resources
      </a>
    
  </h7>

          <nav class="Resources">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/contributing/index.html">
        Contributing
      </a>
    
  </h7>

          <nav class="Contributing">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/FAQ/index.html">
        FAQ
      </a>
    
  </h7>

          <nav class="FAQ">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/from-version-4-to-5/index.html">
        From version 4 to 5
      </a>
    
  </h7>

          <nav class="From version 4 to 5">
            
          </nav>
        
      </div>  
    
      <div id="v4" style="display: none;">
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/index.html">
        What is Mongock?
      </a>
    
  </h7>

          <nav class="What is Mongock?">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/main-concepts/index.html">
        Main concepts
      </a>
    
  </h7>

          <nav class="Main concepts">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/quick-start/index.html">
        Quick start
      </a>
    
  </h7>

          <nav class="Quick start">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/changelogs/index.html">
        Changelogs
      </a>
    
  </h7>

          <nav class="Changelogs">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/driver/index.html">
        Driver
      </a>
    
  </h7>

          <nav class="Driver">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/runner/index.html">
        Runner
      </a>
    
  </h7>

          <nav class="Runner">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/compatibility/index.html">
        Compatibility
      </a>
    
  </h7>

          <nav class="Compatibility">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/lock/index.html">
        Lock
      </a>
    
  </h7>

          <nav class="Lock">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/custom-injections/index.html">
        Custom injections
      </a>
    
  </h7>

          <nav class="Custom injections">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/spring-features/index.html">
        Spring features
      </a>
    
  </h7>

          <nav class="Spring features">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/advanced-configuration/index.html">
        Advanced configuration
      </a>
    
  </h7>

          <nav class="Advanced configuration">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/transactions/index.html">
        Transactions
      </a>
    
  </h7>

          <nav class="Transactions">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/reactive/index.html">
        Reactive
      </a>
    
  </h7>

          <nav class="Reactive">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/events/index.html">
        Events
      </a>
    
  </h7>

          <nav class="Events">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/legacy-migration/index.html">
        Legacy migration
      </a>
    
  </h7>

          <nav class="Legacy migration">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/releases/index.html">
        Releases
      </a>
    
  </h7>

          <nav class="Releases">
            
          </nav>
        
      </div>  
    
      <div id="v3" style="display: none;">
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v3/index.html">
        Version3
      </a>
    
  </h7>

          <nav class="Version3">
            
          </nav>
        
      </div>  
    
  </nav>
</aside>

      <article>
        <p><div class="table-of-contents"><h2>Table of Contents</h2><ul><li><a href="#introduction"> Introduction</a></li><li><a href="#mongodb-driver-options-and-compatibility"> MongoDB driver options and compatibility</a></li><li><a href="#mongodb-common-configuration"> MongoDB common configuration</a><ul><li><a href="#properties"> Properties</a></li></ul></li><li><a href="#mongodb-springdata"> MongoDB Springdata</a><ul><li><a href="#get-started"> Get started</a></li></ul></li><li><a href="#mongodb-native-drivers"> MongoDB native drivers</a><ul><li><a href="#get-started"> Get started</a></li></ul></li><li><a href="#examples"> Examples</a></li></ul></div></p>
<h2 id="introduction"><a class="header-anchor" href="#introduction">#</a> Introduction</h2>
<p>The concept of driver and how it works is already explained in the <a href="/v5/technical-overview">technical-overview</a> and <a href="/v5/driver">driver</a> pages.</p>
<p>Here we explain how to use a driver with MongoDB and the different drivers Mongock provides.</p>
<br />
<hr>
<h2 id="mongodb-driver-options-and-compatibility"><a class="header-anchor" href="#mongodb-driver-options-and-compatibility">#</a> MongoDB driver options and compatibility</h2>
<p><strong>There are 4 drivers in the MongoDB family driver:</strong></p>
<table>
<thead>
<tr>
<th>Mongock driver</th>
<th>Driver library</th>
<th>Version compatibility</th>
</tr>
</thead>
<tbody>
<tr>
<td>SpringDataMongoV3Driver</td>
<td>org.springframework.data:spring-data-mongodb</td>
<td>3.X.X</td>
</tr>
<tr>
<td>SpringDataMongoV2Driver</td>
<td>org.springframework.data:spring-data-mongodb</td>
<td>2.X.X</td>
</tr>
<tr>
<td>MongoSync4Driver</td>
<td>org.mongodb:mongodb-driver-sync</td>
<td>4.X.X</td>
</tr>
<tr>
<td>MongoSync3Driver</td>
<td>org.mongodb:mongo-java-driver</td>
<td>3.X.X</td>
</tr>
</tbody>
</table>
<br />
<hr>
<h2 id="mongodb-common-configuration"><a class="header-anchor" href="#mongodb-common-configuration">#</a> MongoDB common configuration</h2>
<p>All the MongoDB drivers share the same configuration.</p>
<p class="tipAlt">When setting configuration via properties file, it must be prefixed by <b>mongock.mongo-db</b></p>
<h3 id="properties"><a class="header-anchor" href="#properties">#</a> Properties</h3>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
<th>Type</th>
<th>Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>writeConcern</strong></td>
<td>Exactly the same MongoDB parameter <strong>write concern</strong>. For more information, visit the official MongoDB documentation for <a href="https://docs.mongodb.com/manual/reference/write-concern/">write concern</a>.</td>
<td>Object</td>
<td>{w:<code>majority</code>,<br />wTimeoutMs: null,<br />j:true}</td>
</tr>
<tr>
<td><strong>readConcern</strong></td>
<td>Exactly the same MongoDB parameter <strong>read concern</strong>. For more information, visit the official MongoDB documentation for <a href="https://docs.mongodb.com/manual/reference/read-concern/">read concern</a>.</td>
<td>String</td>
<td><code>majority</code></td>
</tr>
<tr>
<td><strong>readPreference</strong></td>
<td>Exactly the same MongoDB parameter <strong>read preference</strong>. For more information, visit the official MongoDB documentation for <a href="https://docs.mongodb.com/manual/reference/read-preference/">read preference</a>.</td>
<td>String</td>
<td><code>primary</code></td>
</tr>
</tbody>
</table>
<br />
<hr>
<h2 id="mongodb-springdata"><a class="header-anchor" href="#mongodb-springdata">#</a> MongoDB Springdata</h2>
<p>Mongock offers two  drivers for MongoDB springdata. The latest, version 3.x, and the previous major version 2.x, just for those who haven't upgraded yet.</p>
<ul>
<li>SpringDataMongoV3Driver</li>
<li>SpringDataMongoV2Driver</li>
</ul>
<h3 id="get-started"><a class="header-anchor" href="#get-started">#</a> Get started</h3>
<p>Following the <a href="/v5/get-started#steps-to-run-mongock">get started section</a>, this covers steps 3 and 5 and 6.</p>
<h4 id="add-maven-dependency-for-the-driver-(step-2)"><a class="header-anchor" href="#add-maven-dependency-for-the-driver-(step-2)">#</a> Add maven dependency for the driver (step 2)</h4>
<pre class="language-xml"><code class="language-xml"><div class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></div><div class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.mongock<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></div><div class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mongodb-springdata-v3-driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></div><div class="highlight-line">  <span class="token comment">&lt;!--&lt;artifactId>mongodb-springdata-v2-driver&lt;/artifactId> for MongoDB spring data v2--></span></div><div class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></div></code></pre>
<h4 id="build-the-driver-(setp-5)"><a class="header-anchor" href="#build-the-driver-(setp-5)">#</a> Build the driver (setp 5)</h4>
<p class="successAlt"><b>This step is only required for builder approach.</b> Mongock handles it for autoconfiguration.</p>
<p>These classes provide the same two static initializers:</p>
<ul>
<li><strong>withDefaultLock</strong>(MongoTemplate mongoTemplate)</li>
<li><strong>withLockStrategy</strong>(MongoTemplate mongoTemplate, long lockAcquiredForMillis, long lockQuitTryingAfterMillis, long lockTryFrequencyMillis)</li>
</ul>
<pre class="language-java"><code class="language-java"><div class="highlight-line"><span class="token class-name">SpringDataMongoV3Driver</span> driver <span class="token operator">=</span> <span class="token class-name">SpringDataMongoV3Driver</span><span class="token punctuation">.</span><span class="token function">withDefaultLock</span><span class="token punctuation">(</span>mongoTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span></div></code></pre>
<h4 id="driver-extra-configuration-(step-6)"><a class="header-anchor" href="#driver-extra-configuration-(step-6)">#</a> Driver extra configuration (step 6)</h4>
<h5 id="transactions"><a class="header-anchor" href="#transactions">#</a> Transactions</h5>
<p>In order to use native transactions, Mongock only needs the <code>MongoTransactionManager</code> injected in the Spring application context and the flag <code>mongock.transaction-enabled</code> not false(it accepts null, but it's highly recommended to explicitly set a value).</p>
<p><em>Keep in mind that your MongoDB database must allow multi-document ACID transactions</em></p>
<pre class="language-java"><code class="language-java"><div class="highlight-line">	<span class="token annotation punctuation">@Bean</span></div><div class="highlight-line">	<span class="token keyword">public</span> <span class="token class-name">MongoTransactionManager</span> <span class="token function">transactionManager</span><span class="token punctuation">(</span><span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="highlight-line">		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MongoTransactionManager</span><span class="token punctuation">(</span>mongoTemplate<span class="token punctuation">.</span><span class="token function">getMongoDbFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="highlight-line">	<span class="token punctuation">}</span></div></code></pre>
<br />
<hr>
<h2 id="mongodb-native-drivers"><a class="header-anchor" href="#mongodb-native-drivers">#</a> MongoDB native drivers</h2>
<p>Mongock offers two  drivers for MongoDB native drivers. The latest, version Sync 4.x, and the previous major version 3.x, just for those who haven't upgraded yet.</p>
<ul>
<li>MongoSync4Driver</li>
<li>MongoCore3Driver</li>
</ul>
<h3 id="get-started-2"><a class="header-anchor" href="#get-started-2">#</a> Get started</h3>
<p>Following the <a href="/v5/get-started#steps-to-run-mongock">get started section</a>, this covers steps 3 and 5 and 6.</p>
<h4 id="add-maven-dependency-for-the-driver-(step-2)-2"><a class="header-anchor" href="#add-maven-dependency-for-the-driver-(step-2)-2">#</a> Add maven dependency for the driver (step 2)</h4>
<pre class="language-xml"><code class="language-xml"><div class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span></div><div class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>io.mongock<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span></div><div class="highlight-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mongodb-driver-sync<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span></div><div class="highlight-line">  <span class="token comment">&lt;!--&lt;artifactId>mongodb-v3-driver&lt;/artifactId> for MongoDB driver v3--></span></div><div class="highlight-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></div></code></pre>
<h4 id="build-the-driver-(setps-5)"><a class="header-anchor" href="#build-the-driver-(setps-5)">#</a> Build the driver (setps 5)</h4>
<p>These classes provide the same two static initializers</p>
<ul>
<li><strong>withDefaultLock</strong>(MongoClient mongoClient, String databaseName)</li>
<li><strong>withLockStrategy</strong>(MongoClient mongoClient, String databaseName, long lockAcquiredForMillis, long lockQuitTryingAfterMillis,long lockTryFrequencyMillis)</li>
</ul>
<pre class="language-java"><code class="language-java"><div class="highlight-line"><span class="token class-name">MongoSync4Driver</span> driver <span class="token operator">=</span> <span class="token class-name">MongoSync4Driver</span><span class="token punctuation">.</span><span class="token function">withDefaultLock</span><span class="token punctuation">(</span>mongoClient<span class="token punctuation">,</span> databaseName<span class="token punctuation">)</span><span class="token punctuation">;</span></div></code></pre>
<h4 id="driver-extra-configuration-(step-6)-2"><a class="header-anchor" href="#driver-extra-configuration-(step-6)-2">#</a> Driver extra configuration (step 6)</h4>
<h5 id="transactions-2"><a class="header-anchor" href="#transactions-2">#</a> Transactions</h5>
<p>Due to the MongoDB API design, to work with transactions the <a href="https://mongodb.github.io/mongo-java-driver/4.3/apidocs/mongodb-driver-sync/com/mongodb/client/ClientSession.html">ClientSession</a> object is required in every operation and then managed the transaction.
Mongock make this very simple. The developer only needs to specify a <code>ClientSession</code> parameter in the contructor or method of the <code>@ChangeUnit</code> and use in the MongoDB operations. <strong>Mongock takes care of everything else.</strong>
<br /><br />
The following code shows how to save documents inside the transaction using the <code>ClientSession</code> object.</p>
<pre class="language-java"><code class="language-java"><div class="highlight-line">  <span class="token annotation punctuation">@Execution</span></div><div class="highlight-line">  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execution</span><span class="token punctuation">(</span><span class="token class-name">ClientSession</span> clientSession<span class="token punctuation">,</span> <span class="token class-name">MongoDatabase</span> mongoDatabase<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="highlight-line">  </div><div class="highlight-line">    mongoDatabase<span class="token punctuation">.</span><span class="token function">getCollection</span><span class="token punctuation">(</span>CLIENTS_COLLECTION_NAME<span class="token punctuation">,</span> <span class="token class-name">Client</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></div><div class="highlight-line">            <span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span>clientSession<span class="token punctuation">,</span> <span class="token class-name">IntStream</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> INITIAL_CLIENTS<span class="token punctuation">)</span></div><div class="highlight-line">                    <span class="token punctuation">.</span><span class="token function">mapToObj</span><span class="token punctuation">(</span><span class="token class-name">ClientInitializerChangeLog</span><span class="token operator">::</span><span class="token function">getClient</span><span class="token punctuation">)</span></div><div class="highlight-line">                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="highlight-line">  <span class="token punctuation">}</span></div></code></pre>
<br />
<hr>
<h2 id="examples"><a class="header-anchor" href="#examples">#</a> Examples</h2>
<p class="successAlt">Please visit out example projects in [this repo](https://github.com/mongock/mongock-examples/tree/master/mongodb) for more information</p>
<h4 id="example-autoconfiguration-with-springboot"><a class="header-anchor" href="#example-autoconfiguration-with-springboot">#</a> Example autoconfiguration with Springboot</h4>
<pre class="language-yaml"><code class="language-yaml"><div class="highlight-line"><span class="token key atrule">mongock</span><span class="token punctuation">:</span></div><div class="highlight-line">  <span class="token key atrule">mongo-db</span><span class="token punctuation">:</span></div><div class="highlight-line">    <span class="token key atrule">write-concern</span><span class="token punctuation">:</span></div><div class="highlight-line">      <span class="token key atrule">w</span><span class="token punctuation">:</span> majority</div><div class="highlight-line">      <span class="token key atrule">wTimeoutMs</span><span class="token punctuation">:</span> <span class="token number">1000</span></div><div class="highlight-line">      <span class="token key atrule">journal</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></div><div class="highlight-line">    <span class="token key atrule">read-concern</span><span class="token punctuation">:</span> majority</div><div class="highlight-line">    <span class="token key atrule">read-preference</span><span class="token punctuation">:</span> primary</div></code></pre>
<pre class="language-java"><code class="language-java"><div class="highlight-line"><span class="token annotation punctuation">@EnableMongock</span></div><div class="highlight-line"><span class="token annotation punctuation">@SpringBootApplication</span></div><div class="highlight-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">QuickStartApp</span> <span class="token punctuation">{</span></div><div class="highlight-line"></div><div class="highlight-line">    <span class="token comment">/**</div><div class="highlight-line">     * Be wared MongoTemplate needs to be injected</div><div class="highlight-line">     */</span></div><div class="highlight-line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="highlight-line">        <span class="token class-name">SpringApplicationBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sources</span><span class="token punctuation">(</span><span class="token class-name">QuickStartApp</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="highlight-line">    <span class="token punctuation">}</span></div><div class="highlight-line"></div><div class="highlight-line">    <span class="token comment">/**</div><div class="highlight-line">     * Transaction Manager.</div><div class="highlight-line">     * Needed to allow execution of changeSets in transaction scope.</div><div class="highlight-line">     */</span></div><div class="highlight-line">    <span class="token annotation punctuation">@Bean</span></div><div class="highlight-line">    <span class="token keyword">public</span> <span class="token class-name">MongoTransactionManager</span> <span class="token function">transactionManager</span><span class="token punctuation">(</span><span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><div class="highlight-line">        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MongoTransactionManager</span><span class="token punctuation">(</span>mongoTemplate<span class="token punctuation">.</span><span class="token function">getMongoDbFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="highlight-line">    <span class="token punctuation">}</span></div><div class="highlight-line"></div><div class="highlight-line"><span class="token punctuation">}</span></div></code></pre>
<h4 id="example-with-builder"><a class="header-anchor" href="#example-with-builder">#</a> Example with builder</h4>
<pre class="language-java"><code class="language-java"><div class="highlight-line"><span class="token comment">//this could be the SpringDataMongoV2Driver passing the same paremeter or MongoSync4Driver/MongoCore3Driver passing the MongoClient and databaseName</span></div><div class="highlight-line"><span class="token class-name">SpringDataMongoV3Driver</span> driver <span class="token operator">=</span> <span class="token class-name">SpringDataMongoV3Driver</span><span class="token punctuation">.</span><span class="token function">withDefaultLock</span><span class="token punctuation">(</span>mongoTemplate<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="highlight-line">driver<span class="token punctuation">.</span><span class="token function">setWriteConcern</span><span class="token punctuation">(</span><span class="token class-name">WriteConcern</span><span class="token punctuation">.</span>MAJORITY<span class="token punctuation">.</span><span class="token function">withJournal</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withWTimeout</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="highlight-line">driver<span class="token punctuation">.</span><span class="token function">setReadConcern</span><span class="token punctuation">(</span><span class="token class-name">ReadConcern</span><span class="token punctuation">.</span>MAJORITY<span class="token punctuation">)</span><span class="token punctuation">;</span></div><div class="highlight-line">driver<span class="token punctuation">.</span><span class="token function">setReadPreference</span><span class="token punctuation">(</span><span class="token class-name">ReadPreference</span><span class="token punctuation">.</span><span class="token function">primary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></code></pre>

      </article>
    </main>

    <!-- Footer -->
    <footer>
  <nav class="page-max-width d-flex flex-space-evenly flex-items-center">
    <a class="d-inline-flex flex-center flex-items-center" href="https://www.mongock.io">Mongock</a>
    <div class="d-flex flex-center flex-items-center">
      <a class="d-inline-flex flex-items-center mr-16" href="https://github.com/mongock/mongock" target="_blank" rel="nofollow">
        <!-- Source: <https://github.com/encharm/Font-Awesome-SVG-PNG/blob/master/black/svg/github.svg> -->
<svg focusable="false" viewBox="0 0 1792 1792"><title>GitHub</title><path d="M896 128q209 0 385.5 103t279.5 279.5 103 385.5q0 251-146.5 451.5t-378.5 277.5q-27 5-40-7t-13-30q0-3 .5-76.5t.5-134.5q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105 20.5-150.5q0-119-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27t-83.5-38.5-85-13.5q-45 113-8 204-79 87-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-39 36-49 103-21 10-45 15t-57 5-65.5-21.5-55.5-62.5q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 88.5t.5 54.5q0 18-13 30t-40 7q-232-77-378.5-277.5t-146.5-451.5q0-209 103-385.5t279.5-279.5 385.5-103zm-477 1103q3-7-7-12-10-3-13 2-3 7 7 12 9 6 13-2zm31 34q7-5-2-16-10-9-16-3-7 5 2 16 10 10 16 3zm30 45q9-7 0-19-8-13-17-6-9 5 0 18t17 7zm42 42q8-8-4-19-12-12-20-3-9 8 4 19 12 12 20 3zm57 25q3-11-13-16-15-4-19 7t13 15q15 6 19-6zm63 5q0-13-17-11-16 0-16 11 0 13 17 11 16 0 16-11zm58-10q-2-11-18-9-16 3-14 15t18 8 14-14z"></path></svg>

      </a>
      <a class="d-inline-flex flex-items-center" href="https://twitter.com/MongockTeam" target="_blank" rel="nofollow">
        <!-- Source: <https://github.com/encharm/Font-Awesome-SVG-PNG/blob/master/black/svg/twitter.svg> -->
<svg focusable="false" viewBox="0 0 1792 1792"><title>Twitter</title><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"></path></svg>

      </a>
    </div>
    <a class="d-inline-flex flex-center flex-items-center" href="https://github.com/mongock/mongock/issues" target="_blank" rel="nofollow">
      <!-- Source: <https://octicons.github.com/icon/issue-opened/> -->
<svg viewBox="0 0 14 16" version="1.1" width="112" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>

      <span class="ml-8">Issues</span>
    </a>
  </nav>
</footer>


  </body>
</html>
