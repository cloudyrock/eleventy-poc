<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Mongock Documentation">

    <title>Mongock Documentation</title>

    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" sizes="any" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png" />
    <link rel="shortcut icon" href="/favicon/favicon.ico" />
    <link href="/styles/base-styles.css" rel="stylesheet" />
    <link href="/styles/content.css" rel="stylesheet" />
    <link href="/styles/layout.css" rel="stylesheet" />
    <link href="/styles/side-menu.css" rel="stylesheet" />
    <link href="/styles/util.css" rel="stylesheet" />
    <link href="/styles/prism-base16-ateliersulphurpool.light.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Fjalla+One|Roboto" rel="stylesheet" />
  </head>

  <body>

    <!-- Header navigation -->
    <header>
  <div class="page-max-width d-flex flex-space-between flex-content-center">
    <div class="d-flex flex-items-center ml-0 mr-auto">
      <a class="logo d-inline-flex flex-items-center" href="https://www.mongock.io">
        <span class="mr-12">Mongock</span>
        <p class="text-left">
          <img src="/images/logo.png" width="15%" alt="Mongock">
        </p>  
       </a>
    </div>

    <nav class="d-flex flex-items-center ml-auto mr-0">
      <a class="mr-24" href="/">
        Home
      </a> 
      <a class="mr-24" href="/v5/professional" style="color: #05a18a;">
        Professional
      </a>
      <a href="https://github.com/mongock/mongock" target="_blank" rel="nofolllow">
        <!-- Source: <https://github.com/encharm/Font-Awesome-SVG-PNG/blob/master/black/svg/github.svg> -->
<svg focusable="false" viewBox="0 0 1792 1792"><title>GitHub</title><path d="M896 128q209 0 385.5 103t279.5 279.5 103 385.5q0 251-146.5 451.5t-378.5 277.5q-27 5-40-7t-13-30q0-3 .5-76.5t.5-134.5q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105 20.5-150.5q0-119-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27t-83.5-38.5-85-13.5q-45 113-8 204-79 87-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-39 36-49 103-21 10-45 15t-57 5-65.5-21.5-55.5-62.5q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 88.5t.5 54.5q0 18-13 30t-40 7q-232-77-378.5-277.5t-146.5-451.5q0-209 103-385.5t279.5-279.5 385.5-103zm-477 1103q3-7-7-12-10-3-13 2-3 7 7 12 9 6 13-2zm31 34q7-5-2-16-10-9-16-3-7 5 2 16 10 10 16 3zm30 45q9-7 0-19-8-13-17-6-9 5 0 18t17 7zm42 42q8-8-4-19-12-12-20-3-9 8 4 19 12 12 20 3zm57 25q3-11-13-16-15-4-19 7t13 15q15 6 19-6zm63 5q0-13-17-11-16 0-16 11 0 13 17 11 16 0 16-11zm58-10q-2-11-18-9-16 3-14 15t18 8 14-14z"></path></svg>

        <span class="ml-8">GitHub</span>
      </a>
    </nav>
  </div>
</header>


    <!-- Main page content -->
    <main class="page-max-width">
      




<script>
const versions = [];

 
versions.push({value: "v5", index: "/index.html" });
  
let defaultVersion = "v5";
  

 
versions.push({value: "v4", index: "/v4/index.html" });
  

 
versions.push({value: "v3", index: "/v3/index.html" });
  


const selectedVersions = defaultVersion;
window.onload = function() {
  const urlVersion = window.location.pathname.split("/")[1];
  let validVersion = "";
  versions.forEach(version => {
    if(urlVersion == version.value) {
      validVersion = urlVersion;
    }
  })
  pickVersion(validVersion);
};

function pickVersion(urlVersion) {
  const pickedVersion = urlVersion || defaultVersion;
  document.getElementById("versionSelect").value = pickedVersion;
  versions.forEach(version => {
    const htmlElement = document.getElementById(version.value);
    if(htmlElement) {
      if(pickedVersion == version.value) {
        htmlElement.style.display = "inline";
      } else {
        htmlElement.style.display = "none";
      }
    }
    
  });
}

function changeVersion() {
  var newVersion = document.getElementById("versionSelect").value;
  for(let i = 0 ; i < versions.length ; i++) {
    const version = versions[i];
    if(version.value == newVersion) {
      window.location.href = window.location.origin + version.index;

    } else {
      console.log("version " + newVersion + " not found. Not redirecting.")
    }
  }
}

</script>






<aside class="side-menu">
  
  <select style="width: 100%" name="version" id="versionSelect" onchange="changeVersion()">
    
      <option value="v5">version 5</option>
    
      <option value="v4">version 4</option>
    
      <option value="v3">version 3</option>
    
  </select>
  <br /><br />



  <nav class="menu-root">
    
      <div id="v5" style="display: none;">
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/index.html">
        What is mongock
      </a>
    
  </h7>

          <nav class="What is mongock">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/technical-overview/index.html">
        Technical overview
      </a>
    
  </h7>

          <nav class="Technical overview">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/get-started/index.html">
        Get started
      </a>
    
  </h7>

          <nav class="Get started">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/migration/index.html">
        Migration
      </a>
    
  </h7>

          <nav class="Migration">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/runner/index.html">
        Runner
      </a>
    
  </h7>

          <nav class="Runner">
            
              
  
  <a class="menu-item "  href="/v5/runner/standalone/index.html">
    Runner: Standalone
  </a>

            
              
  
  <a class="menu-item "  href="/v5/runner/springboot/index.html">
    Runner: Springboot
  </a>

            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/driver/index.html">
        Driver
      </a>
    
  </h7>

          <nav class="Driver">
            
              
  
  <a class="menu-item "  href="/v5/driver/mongodb-sync/index.html">
    MongoDB Sync
  </a>

            
              
  
  <a class="menu-item "  href="/v5/driver/mongodb-springdata/index.html">
    MongoDB Spring data
  </a>

            
              
  
  <a class="menu-item "  href="/v5/driver/mongodb-reactive/index.html">
    MongoDB reactive
  </a>

            
              
  
  <a class="menu-item "  href="/v5/driver/cosmosdb/index.html">
    CosmosDB
  </a>

            
              
  
  <a class="menu-item "  href="/v5/driver/documentdb/index.html">
    DocumentDB
  </a>

            
              
  
  <a class="menu-item "  href="/v5/driver/dynamodb/index.html">
    DynamoDB
  </a>

            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      Features
    
  </h7>

          <nav class="Features">
            
              
  
  <a class="menu-item current-page"  href="/v5/features/transactions/index.html">
    Transactions
  </a>

            
              
  
  <a class="menu-item "  href="/v5/features/events/index.html">
    Events
  </a>

            
              
  
  <a class="menu-item "  href="/v5/features/legacy-migration/index.html">
    Legacy migration
  </a>

            
              
  
  <a class="menu-item "  href="/v5/features/custom-injections/index.html">
    Custom injections
  </a>

            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/cli/index.html">
        CLI
      </a>
    
  </h7>

          <nav class="CLI">
            
              
  
  <a class="menu-item "  href="/v5/cli/operations/index.html">
    Operations
  </a>

            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/resources/index.html">
        Resources
      </a>
    
  </h7>

          <nav class="Resources">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/testing/index.html">
        Testing
      </a>
    
  </h7>

          <nav class="Testing">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/professional/index.html">
        Professional
      </a>
    
  </h7>

          <nav class="Professional">
            
              
  
  <a class="menu-item "  href="/v5/professional/setup.html">
    Set up
  </a>

            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/contributing/index.html">
        Contributing
      </a>
    
  </h7>

          <nav class="Contributing">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/faq/index.html">
        FAQ
      </a>
    
  </h7>

          <nav class="FAQ">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v5/from-version-4-to-5/index.html">
        From version 4 to 5
      </a>
    
  </h7>

          <nav class="From version 4 to 5">
            
          </nav>
        
      </div>  
    
      <div id="v4" style="display: none;">
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/index.html">
        What is Mongock?
      </a>
    
  </h7>

          <nav class="What is Mongock?">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/main-concepts/index.html">
        Main concepts
      </a>
    
  </h7>

          <nav class="Main concepts">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/quick-start/index.html">
        Quick start
      </a>
    
  </h7>

          <nav class="Quick start">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/changelogs/index.html">
        Changelogs
      </a>
    
  </h7>

          <nav class="Changelogs">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/driver/index.html">
        Driver
      </a>
    
  </h7>

          <nav class="Driver">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/runner/index.html">
        Runner
      </a>
    
  </h7>

          <nav class="Runner">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/compatibility/index.html">
        Compatibility
      </a>
    
  </h7>

          <nav class="Compatibility">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/lock/index.html">
        Lock
      </a>
    
  </h7>

          <nav class="Lock">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/custom-injections/index.html">
        Custom injections
      </a>
    
  </h7>

          <nav class="Custom injections">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/spring-features/index.html">
        Spring features
      </a>
    
  </h7>

          <nav class="Spring features">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/advanced-configuration/index.html">
        Advanced configuration
      </a>
    
  </h7>

          <nav class="Advanced configuration">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/transactions/index.html">
        Transactions
      </a>
    
  </h7>

          <nav class="Transactions">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/reactive/index.html">
        Reactive
      </a>
    
  </h7>

          <nav class="Reactive">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/events/index.html">
        Events
      </a>
    
  </h7>

          <nav class="Events">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/legacy-migration/index.html">
        Legacy migration
      </a>
    
  </h7>

          <nav class="Legacy migration">
            
          </nav>
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v4/releases/index.html">
        Releases
      </a>
    
  </h7>

          <nav class="Releases">
            
          </nav>
        
      </div>  
    
      <div id="v3" style="display: none;">
         
          
  
  <h7 class="menu-item">
    
      <a class="menu-item "  href="/v3/index.html">
        Version3
      </a>
    
  </h7>

          <nav class="Version3">
            
          </nav>
        
      </div>  
    
  </nav>
</aside>

      <article>
        <h1 class="title">Transactions</h1>
<p><div class="table-of-contents"><h2>Table of Contents</h2><ul><li><a href="#introduction"> Introduction</a></li><li><a href="#configuration"> Configuration</a></li><li><a href="#how-it-works"> How it works</a></li><li><a href="#best-practices"> Best practices</a></li></ul></div></p>
<h2 id="introduction"><a class="header-anchor" href="#introduction">#</a> Introduction</h2>
<p>We already discussed the <a href="/v5/technical-overview#mongock-process">Mongock process</a> and the <a href="/v5/migration">migration component</a> in previous sections where the transactions are already mentioned.</p>
<p>As its name suggests, a changeUnit represents the unit of a migration. By default each changeUnit is wrapped in a independent transaction. This can be change by configuration, but it's not recommended.</p>
<div class="tip">
<p>In this section we mention <b>native transactions</b>. By this we mean the transaction mechanism provided by the database.</p>
<p>Mongock always try to provide a transactional environment as much as possible. When native transactions are not possible, it tries to rollback the changes manually with the <a href="/v5/migration#changeunit-methods">@RollbackExecution</a> method.</p>
</div>
<h2 id="configuration"><a class="header-anchor" href="#configuration">#</a> Configuration</h2>
<p>There are two points where the transactions are configured to be enforced or disabled, the property <code>mongock.transactionEnabled</code>(setTransactionEnabled method in the builder) and the <strong>driver</strong>.</p>
<p>In every driver's page, you will find enough information about how to enable the native transactions. Sometimes they are enabled by default and other times, like in the Springboot ecosystems, the transactions manager needs to be injected in the context.</p>
<p>As explained in the <a href="/v5/runner#Configuration">runner properties table</a>, the Mongock native transactionability follows the next logic:</p>
<div class="success">
<p >When <b>mongock.transactionEnabled</b> is true, it enforces native transactions, throwing an exception is the driver is not capable of it.</p>
<p >When <b>mongock.transactionEnabled</b> is false, it disables the transactions and ignores the transactionability of the driver.</p>
<p >When <b>mongock.transactionEnabled</b> is null, it totally delegates on the driver the transactionability of the migration.</p>
</div>
<h2 id="how-it-works"><a class="header-anchor" href="#how-it-works">#</a> How it works</h2>
<p>The easiest way to understand how Mongock handles the transactions is by looking at <a href="/v5/technical-overview#process-steps">this section</a>.</p>
<h2 id="best-practices"><a class="header-anchor" href="#best-practices">#</a> Best practices</h2>
<ul>
<li>Always set explicitly the <code>mongock.transactionEnabled</code> property to true/false.</li>
<li>DDL operations placed in the @BeforeExecution method of the changeUnit.</li>
</ul>

      </article>
    </main>

    <!-- Footer -->
    <footer>
  <nav class="page-max-width d-flex flex-space-evenly flex-items-center">
    <a class="d-inline-flex flex-center flex-items-center" href="https://www.mongock.io">Mongock</a>
    <div class="d-flex flex-center flex-items-center">
      <a class="d-inline-flex flex-items-center mr-16" href="https://github.com/mongock/mongock" target="_blank" rel="nofollow">
        <!-- Source: <https://github.com/encharm/Font-Awesome-SVG-PNG/blob/master/black/svg/github.svg> -->
<svg focusable="false" viewBox="0 0 1792 1792"><title>GitHub</title><path d="M896 128q209 0 385.5 103t279.5 279.5 103 385.5q0 251-146.5 451.5t-378.5 277.5q-27 5-40-7t-13-30q0-3 .5-76.5t.5-134.5q0-97-52-142 57-6 102.5-18t94-39 81-66.5 53-105 20.5-150.5q0-119-79-206 37-91-8-204-28-9-81 11t-92 44l-38 24q-93-26-192-26t-192 26q-16-11-42.5-27t-83.5-38.5-85-13.5q-45 113-8 204-79 87-79 206 0 85 20.5 150t52.5 105 80.5 67 94 39 102.5 18q-39 36-49 103-21 10-45 15t-57 5-65.5-21.5-55.5-62.5q-19-32-48.5-52t-49.5-24l-20-3q-21 0-29 4.5t-5 11.5 9 14 13 12l7 5q22 10 43.5 38t31.5 51l10 23q13 38 44 61.5t67 30 69.5 7 55.5-3.5l23-4q0 38 .5 88.5t.5 54.5q0 18-13 30t-40 7q-232-77-378.5-277.5t-146.5-451.5q0-209 103-385.5t279.5-279.5 385.5-103zm-477 1103q3-7-7-12-10-3-13 2-3 7 7 12 9 6 13-2zm31 34q7-5-2-16-10-9-16-3-7 5 2 16 10 10 16 3zm30 45q9-7 0-19-8-13-17-6-9 5 0 18t17 7zm42 42q8-8-4-19-12-12-20-3-9 8 4 19 12 12 20 3zm57 25q3-11-13-16-15-4-19 7t13 15q15 6 19-6zm63 5q0-13-17-11-16 0-16 11 0 13 17 11 16 0 16-11zm58-10q-2-11-18-9-16 3-14 15t18 8 14-14z"></path></svg>

      </a>
      <a class="d-inline-flex flex-items-center" href="https://twitter.com/MongockTeam" target="_blank" rel="nofollow">
        <!-- Source: <https://github.com/encharm/Font-Awesome-SVG-PNG/blob/master/black/svg/twitter.svg> -->
<svg focusable="false" viewBox="0 0 1792 1792"><title>Twitter</title><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"></path></svg>

      </a>
    </div>
    <a class="d-inline-flex flex-center flex-items-center" href="https://github.com/mongock/mongock/issues" target="_blank" rel="nofollow">
      <!-- Source: <https://octicons.github.com/icon/issue-opened/> -->
<svg viewBox="0 0 14 16" version="1.1" width="112" aria-hidden="true"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg>

      <span class="ml-8">Issues</span>
    </a>
  </nav>
</footer>


  </body>
</html>
